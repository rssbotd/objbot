#!/usr/bin/env python3
# This file is placed in the Public Domain.
# pylint: disable=C0413,W0611


"prompt"


import os
import readline
import sys
import termios


sys.path.insert(0, os.getcwd())


from objz.console import Console
from objz.default import Default
from objr.errors  import errors
from objz.main    import cmnd, init
from objz.parse   import parse
from objz.utils   import forever, modnames


from objbot.modules import face


Cfg = Default()
Cfg.mod = "cmd,err,mod,thr"


def wrap(func):
    "reset console."
    old3 = None
    try:
        old3 = termios.tcgetattr(sys.stdin.fileno())
    except termios.error:
        pass
    try:
        func()
    except (KeyboardInterrupt, EOFError):
        pass
    finally:
        if old3:
            termios.tcsetattr(sys.stdin.fileno(), termios.TCSADRAIN, old3)


def main():
    "main"
    parse(Cfg, " ".join(sys.argv[1:]))
    csl = Console(print)
    if "i" in Cfg.opts:
        Cfg.mod = ",".join(modnames(face))
        init(Cfg.mod, face)
    csl.loop()


if __name__ == "__main__":
    wrap(main)
    errors()
